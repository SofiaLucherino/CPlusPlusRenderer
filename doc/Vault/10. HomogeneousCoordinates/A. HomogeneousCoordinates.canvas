{
	"nodes":[
		{"id":"b294ed0bbc955f08","type":"text","text":"Наразі проектування точок з простору на двовимірний екран у нас відбувалося завдяки функції, проте чи можливо замінити її на матрицю?","x":-1000,"y":-580,"width":600,"height":58,"color":"#ff0000"},
		{"id":"9932c99f72fbf25b","type":"text","text":"- Z-координат:\n\t- Ми хочемо після проектування малювати тільки ті об'єкти що знаходяться в межах від (Близько, Далеко), де:\n\t\t- Близько - найближча до фокусу камери Z-координата що малюється\n\t\t- Далеко - найбільш далека від фокусу камери Z-координата що малюється\n\t- Для цього зробимо так щоб наша матриця зводила точки у межах (Близько, Далеко) до меж (0, 1):\n\t\t- Маємо дві комірки матриці що нам допоможуть, одна з них може додати значення до Z координати (4 стовпець 3 рядок), будемо позначати її значення як В, друга множить Z координату на число (3 стовпець 3 рядок), позначимо її значення А\n\t\t- Тоді Z' = (Z * A + B) / Z = A + B/Z\n\t\t- Ми хочемо щоб коли  Z = Близько, то  Z' = 0:\n\t\t\t- A + B/Близько = 0\n\t\t\t- А = -B/Близько\n\t\t- Ми хочемо щоб коли  Z = Далеко, то  Z' = 1:\n\t\t\t-  A + B/Далеко = 1\n\t\t\t- А = 1 - B/Далеко\n\t\t- Тепер спробуємо знайти В:\n\t\t\t- $А = -B/Близько = 1 - B/Далеко$\n\t\t\t- $B/Далеко -B/Близько = 1$\n\t\t\t- $В * (1/Далеко - 1/Близько) = 1$\n\t\t\t- $B = 1 / (1/Далеко - 1/Близько) = 1/ (Близько/Далеко*Близько - Далеко/Далеко*Близько) = 1/ ((Близько - Далеко) / Далеко*Близько) = Далеко*Близько/(Близько - Далеко)$\n\t\t- Із цього знайдемо А:\n\t\t\t- А = -B/Близько = - Далеко*Близько/((Близько - Далеко) * Близько) = - Далеко/(Близько - Далеко)\n\t- Отже маємо потрібні значення елементів матрицs","x":-1000,"y":10,"width":1478,"height":630,"color":"#ff00c8"},
		{"id":"715e853558f9d562","type":"text","text":"Однорідні координати - Перспектива:\n- Ми проектуємо точку ділячи її X і Y координати на Z координату, проте як можна поділити матрицею перші два члени вектори на третій\n- Ми можемо тільки помножити матрицею на Z тому скористаємося обхідним шляхом:\n\t- Після множення на матрицю наше W значення може стати відмінним від одиниці\n\t- Будемо інтерпретувати такі вектори як ненормалізовані, тобто їх значення XYZ не є вірним, а буде таким тільки після приведення вектору шляхом множення чи ділення до такого де W = 1\n\t- Тобто ми будемо ділити кожну координату на W (нормалізуємо), і тоді він буде дорівнювати 1 а XYZ будут тими що ми в ньому і хочемо інтерпретувати\n\t- В такому разі для того щоб поділити перші дві координати на Z, то наш елемент W повинен дорівнювати Z, так як після цього чи будемо на нього ділити кожну координату вектора\n\t- Отже наша матриця буде переписувати W значенням Z, що дуже легко реалізувати записавши одиницю в 4 рядку в 3 колонці матриці а усі інші елементи рядку прирівняти до нуля\n- Отже для того щоб отримати нашу матрицю ми використаємо одиничну матрицю, пермістивши четверту одиницю з четвертого стовпця 4 рядка до 3 стовпця 4 рядка. Потім отриманий вектор внаслідок множення на матрицю нормалізуємо діленням на W","x":-1118,"y":-495,"width":837,"height":471,"color":"#a600ff"},
		{"id":"38870babb6e5d394","type":"text","text":"Перспективна матриця:\n- Є декілька речей що ми хочемо додати при проектуванні на площину екрану, а саме:\n\t- Врахування відношення сторін екрану \n\t- Кут огляду камери\n\t- Z-координат для буферизації, приведенний до рамок від 0 до 1, з цими рамками в якості аргументу матриці","x":-100,"y":-602,"width":936,"height":180,"color":"#c800ff"},
		{"id":"4bcf7a1efcd145da","type":"text","text":"Співвідношення сторін:\n\t- Ми хочемо щоб зображення незалежно від розмірів вікна зберігало свої пропорції\n\t- Для цього візьмемо кінці висоти вікна за -1 і 1, і спробуємо знайти кінці ширини вікна відносно них\n\t- Використаємо для цього значення співвідношення сторін, воно дорівнює ширині вікна поділеній на висоту вікна\n\t- Тепер ми хочесо щоб кінці ширини вікна були такі самі що і у висоти проте домноженні на співвідношення сторін\n\t- Тоді зображення завжди буде мати однакові пропорції, і в залежності від розмірів вікна ми просто будемо або не будемо малювати (-СпівСторін, СпівСторін) на ньому ті частини що до цього малювалися (-1, 1)\n\t- Для цього використаємо трюк, будемо малювати тільки ті точки що після проектвання на екран мають значення координат від -1 до 1, проте у самій матриці проектування будемо попередньо ділити ікс на СпівСторін, тоді в залежності від цього параметру до проміжку екрану (-1, 1) будуть приводитися точки в проміжку (-СпівСторін, СпівСторін) що ми і хотіли закодувати\n\t- Отже просто записуємо в перший стовбець першого рядку значення \"1/СпівСторін\"","x":-100,"y":-360,"width":1011,"height":316,"color":"#ff00ff"},
		{"id":"063da9f8f7b2131f","type":"text","text":"- Кут огляду:\n\t- При проектуванні ми хочемо мати змогу змінити кут огляду сцени, для цього маємо постійну довжину екрану на який проектуємо і будемо віддаляти/приближати його від фокусу камери відповідно до кута що ми хочемо отримати\n\t- В такому разі, запишемо відстань між фокусам і екраном як d, а половину екрана буде сталим числом для зручності візьмемо 1\n\t- Тоді тангенс половини кута огляду буде дорівнювати 1/d, відповідно саме d = 1/tan(КутОгляду/2)\n\t- Для того щоб отримати координати для нової камери зі старих, можемо використати співвідношення у подібних трикутниках, так як стара і нова камера разом із точкою на старій утворюють такі трикутники відповідно  справедливе таке рівняння:\n\t\t- Стара координата/Стара відстань до екрану = Нова координата/Нова відстань до екрану\n\t\t- Маємо що стара відстань до екрану була 1 - для кута огляду 90 градусів, тоді:\n\t\t- Нова координата = (Стара координата * Нова відстань до екрану)/Стара відстань до екрану\n\t\t- Нова координата = (Стара координата * d)/1 = Стара координата * d\n\t- Отже, для того щоб проектувати під іншим кутом наша матриця повинна ділити X і Y координати на тангенс поточного кута огляду\n\t- Маємо \"1/(СпівСторін * tan(КутОгляду/2))\" у першому рядку першого стовпця і \"1/tan(КутОгляду/2)\" у другому рядку другого стовпця","x":500,"y":154,"width":1011,"height":486,"color":"#ff00ff"},
		{"id":"bfdf9513f4bd75eb","type":"text","text":"Матриця проектування\n\n|                                   |                    |                             |                                       |\n| --------------------------------- | ------------------ | --------------------------- | ------------------------------------- |\n| 1/(СпівСторін * tan(КутОгляду/2)) | 0                  | 0                           | 0                                     |\n| 0                                 | 1/tan(КутОгляду/2) | 0                           | 0                                     |\n| 0                                 | 0                  | - Далеко/(Близько - Далеко) | (Далеко * Близько)/(Близько - Далеко) |\n| 0                                 | 0                  | 1                           | 0                                     |\n","x":-100,"y":685,"width":1020,"height":209,"color":"#ff0064"},
		{"id":"0b68c4dfb7849952","type":"file","file":"!Personal/Now/CG/Labs/CPlusPlus3DRender/10. HomogeneousCoordinates/PNG/PerspectiveMatrice.png","x":960,"y":685,"width":503,"height":209,"color":"#ff0064"},
		{"id":"d1e64bc0a77f6f5c","type":"text","text":"- Проте важливе питання, чи зберігаються властивості інтерполяції глибини після цього, або вона уде працювати некорректно?: \n\t- Доведемо що Z координата після проектування зберігає властивості потрібні для Z-буфферизаціїї:\n\t\t- Z' = Z'0 +t(Z'1 - Z'0)\n\t\t- Z' = A + (B/Z0) + t(A + (B/Z1) - A - (B/Z0))\n\t\t- Z' = A + B( 1/Z0 + t( 1/Z1 - 1/Z0 ) )\n\t- Бачимо що при інтерполяції Z' зберігається інтерполяція по 1/Z\n\t- Отже можемо нарешті записати нашу матрицю проектування","x":-1000,"y":660,"width":863,"height":259,"color":"#ff0096"}
	],
	"edges":[
		{"id":"a3cf2ca63df54dde","fromNode":"9932c99f72fbf25b","fromSide":"left","toNode":"d1e64bc0a77f6f5c","toSide":"left"},
		{"id":"3add45391da2e35f","fromNode":"d1e64bc0a77f6f5c","fromSide":"right","toNode":"bfdf9513f4bd75eb","toSide":"left"},
		{"id":"d3c28363ac037c75","fromNode":"bfdf9513f4bd75eb","fromSide":"right","toNode":"0b68c4dfb7849952","toSide":"left"},
		{"id":"4c095d79587918e3","fromNode":"38870babb6e5d394","fromSide":"left","toNode":"9932c99f72fbf25b","toSide":"top"},
		{"id":"6d8fe51ff9592bb2","fromNode":"38870babb6e5d394","fromSide":"left","toNode":"4bcf7a1efcd145da","toSide":"left"},
		{"id":"c06087527ead903b","fromNode":"38870babb6e5d394","fromSide":"right","toNode":"063da9f8f7b2131f","toSide":"top"},
		{"id":"a5da3eeff2d618d4","fromNode":"b294ed0bbc955f08","fromSide":"bottom","toNode":"715e853558f9d562","toSide":"top"},
		{"id":"9383172917a3463d","fromNode":"715e853558f9d562","fromSide":"right","toNode":"38870babb6e5d394","toSide":"left"}
	]
}